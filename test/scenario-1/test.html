<html>
    <script runat="server">
        Platform.Load("core","1.1");
       
        try {
          
          var query = Platform.Variable.GetValue("@query");
      
          //var query = "tags%9014I0000007TFBX+tags%9014I0000007TADV"; // "TLS%tag+XLOS%tag+FS%tag+HC%tag+BS%tag";
          var qArr = query.split("+")
          var queryArray = [];
          var filters = [];
          var mainFilter;
      
          function FilterObject(property, value) {
            this.property = property;
            this.value = value;
          };
      
          function getQueries() {
            for (var i = 0; i < qArr.length; i++) {
              var arrObj = qArr[i].split("#");
              var queryObject = new FilterObject(arrObj[0],arrObj[1]);
              queryArray.push(queryObject);
            };
            Write("Filters: " + Stringify(queryArray) + "<br><br>");
          };
      
          getQueries();
      
          function SimpleFilter(property, value) {
            this.Property = property;
            this.SimpleOperator = "like";
            this.Value = value;
          };
      
          function Filter(leftOperand, rightOperand) {
            this.LeftOperand = leftOperand;
            this.LogicalOperator = "OR";
            this.RightOperand = rightOperand;
          };
      
          function generateQueryArray() {
            for (var i = 0; i < queryArray.length; i++) {
              var simpleFilter = new SimpleFilter(queryArray[i].property, queryArray[i].value);
              filters.push(simpleFilter);
              Write("Simple Filter: " + Stringify(simpleFilter) + "<br><br>");
            };
            Write("Filters: " + Stringify(filters) + "<br><br>");
          };
      
          generateQueryArray();
      
          function generateFilters() {
            while (filters.length > 1) {
              for (var i = 0; i < filters.length; i+=2) {
                var newFilter = new Filter(filters[0], filters[1]);
                filters.push(newFilter)
                filters.splice(0, 2)
                Write("New filter: " + Stringify(newFilter) + "<br><br>");
              };
            };
          };
      
      
          generateFilters();
          var mainFilter = filters[0]
          Write("=== Main filter" + Stringify(mainFilter) + "<br><br>");
          
          
          var DE = DataExtension.Init("DC66507E-5E9C-4165-9848-AF4BF88E61FA"); // Querying CH-Form-Interest-DE
          var forms = DE.Rows.Retrieve(mainFilter);
          Write("Forms: " + Stringify(forms) + "<br><br>")
          Write("Forms: " + forms.length + "<br><br>")
          
         /*var complexFilters = {
            "LeftOperand":{
                "Property":"interestID",
                "SimpleOperator":"equals",
                "Value":"7014I0000006p1UQAQ"
                },
            "LogicalOperator":"AND",
            "RightOperand":{
                "Property":"formType",
                "SimpleOperator":"equals",
                "Value":"contact"
                }
            }
        var forms_2 = DE.Rows.Retrieve(complexFilters);
          Write("Forms: " + Stringify(forms_2) + "<br><br>")
          Write("Forms: " + forms_2.length + "<br><br>")*/
        } catch(e) {
          
          Write(Stringify(e))
        
        };
         
      </script>
</html>